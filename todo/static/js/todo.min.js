(function(){var a;a=function(c){var d,b,e;e="a-zA-Z0-9";d=e+"_-";b=c.el=function(u,r){var t,m,j,s,g,h,q,o,n,i,l,k,p,f;if(u==null){u=""}if(r==null){r={}}j=[];n=u.match(RegExp("^(["+e+"]*)(([#.]["+d+"]+)*)$"));u=n[1]?n[1]:"div";if(n[2]!=null){o=n[2].match(RegExp("([#.]["+d+"]+)","g"));if(o!=null){for(l=0,p=o.length;l<p;l++){m=o[l];q=m.slice(0,1);h=m.slice(1);if(q==="#"){g=h}else{j.push(h)}}}}t=c(document.createElement(u));for(k=0,f=j.length;k<f;k++){s=j[k];t.addClass(s)}if(g!=null){t.attr("id",g)}for(m in r){i=r[m];if(m==="text"||m==="html"||m==="val"){t[m](i)}else{t.attr(m,i)}}return t};c.fn.el=function(f,g){return b(f,g).appendTo(this)};c.fn.appendEl=function(f,g){return this.append(b(f,g))};return b};if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}).call(this);(function($){$.fn.editable=function(target,options){if("disable"==target){$(this).data("disabled.editable",true);return}if("enable"==target){$(this).data("disabled.editable",false);return}if("destroy"==target){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var settings=$.extend({},$.fn.editable.defaults,{target:target},options);var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types.defaults.buttons;var content=$.editable.types[settings.type].content||$.editable.types.defaults.content;var element=$.editable.types[settings.type].element||$.editable.types.defaults.element;var reset=$.editable.types[settings.type].reset||$.editable.types.defaults.reset;var callback=settings.callback||function(){};var onedit=settings.onedit||function(){};var onsubmit=settings.onsubmit||function(){};var onreset=settings.onreset||function(){};var onerror=settings.onerror||reset;if(settings.tooltip){$(this).attr("title",settings.tooltip)}settings.autowidth="auto"==settings.width;settings.autoheight="auto"==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();$(this).data("event.editable",settings.event);if(!$.trim($(this).html())){$(this).html(settings.placeholder)}$(this).bind(settings.event,function(e){if(true===$(this).data("disabled.editable")){return}if(self.editing){return}if(false===onedit.apply(this,[settings,self])){return}e.preventDefault();e.stopPropagation();if(settings.tooltip){$(self).removeAttr("title")}if(0==$(self).width()){settings.width=savedwidth;settings.height=savedheight}else{if(settings.width!="none"){settings.width=settings.autowidth?$(self).width():settings.width}if(settings.height!="none"){settings.height=settings.autoheight?$(self).height():settings.height}}if($(this).html().toLowerCase().replace(/(;|"|\/)/g,"")==settings.placeholder.toLowerCase().replace(/(;|"|\/)/g,"")){$(this).html("")}self.editing=true;self.revert=$(self).html();$(self).html("");var form=$("<form />");if(settings.cssclass){if("inherit"==settings.cssclass){form.attr("class",$(self).attr("class"))}else{form.attr("class",settings.cssclass)}}if(settings.style){if("inherit"==settings.style){form.attr("style",$(self).attr("style"));form.css("display",$(self).css("display"))}else{form.attr("style",settings.style)}}var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self])},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]))}else{$.extend(loaddata,settings.loaddata)}$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false}})}else{if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings])}}else{input_content=self.revert}}content.apply(form,[input_content,settings,self]);input.attr("name",settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(":input:visible:enabled:first",form).focus();if(settings.select){input.select()}input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self]);settings.onblur_cb.call(self,e)}});var t;input.blur(settings.onblur_cb);if("cancel"==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self])},500)})}else{if("submit"==settings.onblur){input.blur(function(e){t=setTimeout(function(){form.submit()},200)})}else{if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings])})}else{input.blur(function(e){})}}}form.submit(function(e){if(t){clearTimeout(t)}e.preventDefault();if(false!==onsubmit.apply(form,[settings,self])){if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[$(self).html(),settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]))}else{$.extend(submitdata,settings.submitdata)}if("PUT"==settings.method){submitdata._method="put"}$(self).html(settings.indicator);var ajaxoptions={type:"POST",data:submitdata,dataType:"html",url:settings.target,success:function(result,status){if(ajaxoptions.dataType=="html"){$(self).html(result)}self.editing=false;callback.apply(self,[result,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr])}};$.extend(ajaxoptions,settings.ajaxoptions);$.ajax(ajaxoptions)}}}$(self).attr("title",settings.tooltip);return false})});this.reset=function(form){if(this.editing){if(false!==onreset.apply(form,[settings,self])){$(self).html(self.revert);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder)}if(settings.tooltip){$(self).attr("title",settings.tooltip)}}}}})};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden"></input>');$(this).append(input);return(input)},content:function(string,settings,original){$(":input:first",this).val(string)},reset:function(settings,original){original.reset(this)},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit()}})}else{var submit=$('<button type="submit" />');submit.html(settings.submit)}$(this).append(submit)}if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel)}else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel)}$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset}else{var reset=$.editable.types.defaults.reset}reset.apply(form,[settings,original]);return false})}}},text:{element:function(settings,original){var input=$("<input />");if(settings.width!="none"){input.attr("width",settings.width)}if(settings.height!="none"){input.attr("height",settings.height)}input.attr("autocomplete","off");$(this).append(input);return(input)}},textarea:{element:function(settings,original){var textarea=$("<textarea />");if(settings.rows){textarea.attr("rows",settings.rows)}else{if(settings.height!="none"){textarea.height(settings.height)}}if(settings.cols){textarea.attr("cols",settings.cols)}else{if(settings.width!="none"){textarea.width(settings.width)}}$(this).append(textarea);return(textarea)}},select:{element:function(settings,original){var select=$("<select />");$(this).append(select);return(select)},content:function(data,settings,original){if(String==data.constructor){eval("var json = "+data)}else{var json=data}for(var key in json){if(!json.hasOwnProperty(key)){continue}if("selected"==key){continue}var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){if($(this).val()==json.selected||$(this).text()==$.trim(original.revert)){$(this).attr("selected","selected")}});if(!settings.submit){var form=this;$("select",this).change(function(){form.submit()})}}}},addInputType:function(name,input){$.editable.types[name]=input}};$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",onblur_cb:function(){},loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);(function(f){f.facebox=function(m,l){f.facebox.loading(m.settings||[]);if(m.ajax){g(m.ajax,l)}else{if(m.image){c(m.image,l)}else{if(m.div){j(m.div,l)}else{if(f.isFunction(m)){m.call(f)}else{f.facebox.reveal(m,l)}}}}};f.extend(f.facebox,{settings:{opacity:0.2,overlay:true,loadingImage:"/facebox/loading.gif",closeImage:"/facebox/closelabel.png",imageTypes:["png","jpg","jpeg","gif"],faceboxHtml:'    <div id="facebox" style="display:none;">       <div class="popup">         <div class="content">         </div>         <a href="#" class="close"></a>       </div>     </div>'},loading:function(){k();if(f("#facebox .loading").length==1){return true}e();f("#facebox .content").empty().append('<div class="loading"><img src="'+f.facebox.settings.loadingImage+'"/></div>');f("#facebox").show().css({top:h()[1]+(i()/10),left:f(window).width()/2-(f("#facebox .popup").outerWidth()/2)});f(document).bind("keydown.facebox",function(l){if(l.keyCode==27){f.facebox.close()}return true});f(document).trigger("loading.facebox")},reveal:function(m,l){f(document).trigger("beforeReveal.facebox");if(l){f("#facebox .content").addClass(l)}f("#facebox .content").empty().append(m);f("#facebox .popup").children().fadeIn("normal");f("#facebox").css("left",f(window).width()/2-(f("#facebox .popup").outerWidth()/2));f(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){f(document).trigger("close.facebox");return false}});f.fn.facebox=function(l){if(f(this).length==0){return}k(l);function m(){f.facebox.loading(true);var n=this.rel.match(/facebox\[?\.(\w+)\]?/);if(n){n=n[1]}j(this.href,n);return false}return this.bind("click.facebox",m)};function k(n){if(f.facebox.settings.inited){return true}else{f.facebox.settings.inited=true}f(document).trigger("init.facebox");d();var l=f.facebox.settings.imageTypes.join("|");f.facebox.settings.imageTypesRegexp=new RegExp("\\.("+l+")(\\?.*)?$","i");if(n){f.extend(f.facebox.settings,n)}f("body").append(f.facebox.settings.faceboxHtml);var m=[new Image(),new Image()];m[0].src=f.facebox.settings.closeImage;m[1].src=f.facebox.settings.loadingImage;f("#facebox").find(".b:first, .bl").each(function(){m.push(new Image());m.slice(-1).src=f(this).css("background-image").replace(/url\((.+)\)/,"$1")});f("#facebox .close").click(f.facebox.close).append('<img src="'+f.facebox.settings.closeImage+'" class="close_image" title="close">')}function h(){var m,l;if(self.pageYOffset){l=self.pageYOffset;m=self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){l=document.documentElement.scrollTop;m=document.documentElement.scrollLeft}else{if(document.body){l=document.body.scrollTop;m=document.body.scrollLeft}}}return new Array(m,l)}function i(){var l;if(self.innerHeight){l=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){l=document.documentElement.clientHeight}else{if(document.body){l=document.body.clientHeight}}}return l}function d(){var l=f.facebox.settings;l.loadingImage=l.loading_image||l.loadingImage;l.closeImage=l.close_image||l.closeImage;l.imageTypes=l.image_types||l.imageTypes;l.faceboxHtml=l.facebox_html||l.faceboxHtml}function j(m,l){if(m.match(/#/)){var n=window.location.href.split("#")[0];var o=m.replace(n,"");if(o=="#"){return}f.facebox.reveal(f(o).html(),l)}else{if(m.match(f.facebox.settings.imageTypesRegexp)){c(m,l)}else{g(m,l)}}}function c(m,l){var n=new Image();n.onload=function(){f.facebox.reveal('<div class="image"><img src="'+n.src+'" /></div>',l)};n.src=m}function g(m,l){f.facebox.jqxhr=f.get(m,function(n){f.facebox.reveal(n,l)})}function b(){return f.facebox.settings.overlay==false||f.facebox.settings.opacity===null}function e(){if(b()){return}if(f("#facebox_overlay").length==0){f("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')}f("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",f.facebox.settings.opacity).click(function(){f(document).trigger("close.facebox")}).fadeIn(200);return false}function a(){if(b()){return}f("#facebox_overlay").fadeOut(200,function(){f("#facebox_overlay").removeClass("facebox_overlayBG");f("#facebox_overlay").addClass("facebox_hide");f("#facebox_overlay").remove()});return false}f(document).bind("close.facebox",function(){if(f.facebox.jqxhr){f.facebox.jqxhr.abort();f.facebox.jqxhr=null}f(document).unbind("keydown.facebox");f("#facebox").fadeOut(function(){f("#facebox .content").removeClass().addClass("content");f("#facebox .loading").remove();f(document).trigger("afterClose.facebox")});a()})})(jQuery);(function(){var c,b,h,a,j,d,l,e,q,k,g,f,i,n,p,o,m;n=false;j=null;d="medium";p=["low","medium","high"];$(document).ajaxSend(function(s,t,r){if(r.url.slice(0,1)==="/"&&r.type==="POST"){return t.setRequestHeader("X-CSRFToken",j)}});$(document).ajaxSuccess(function(s,u,r){var t;t=$.parseJSON(u.responseText);if(t.csrftoken!=null){return j=t.csrftoken}});$.extend($.facebox.settings,{loadingImage:"img/loading.gif",closeImage:"img/closelabel.png"});e=function(s){var r;r=$("#messages").empty();if(s.error!=null){r.appendEl(".error",{text:s.error})}if(s.status!=null){return r.appendEl(".info",{text:s.status})}};g=function(){return $.el("tr.table-header").appendEl("th").appendEl("th",{text:"Item"}).appendEl("th",{text:"Priority"})};i=function(w){var u,t,r,v,s;if(w==null){w=d}r=$.el("select");for(v=0,s=p.length;v<s;v++){t=p[v];u=$.el("option",{value:t,text:t});if(t===w){u.attr("selected",true)}r.append(u)}r.change(function(){var z,C,D,x,y,B,A;z=$(this);B=z.find("option:selected").val();A=z.parent().data(),D=A.id,x=A.old_priority;y="/api/todo/modify/";C={id:D,priority:B};return $.post(y,C,function(E,G,F){if(E.error!=null){z.text(x)}else{z.parent().data("old_priority",B)}return e(E)})});return r};k=function(s){var r;r=s.el("td.delbtn",{html:'<a href="" class="delete-btn">X</a>'});r.click(l);return r};f=function(){var r;r="/api/account/";return $.get(r,function(t,u,s){if(t.error!=null){return}o(t.username);if(t.username!=null){return m()}})};o=function(w){var s,t,v,u,r;t=$("#account-info").empty();if(w!=null){u=$.el("a.logout",{href:"",text:"Log out"});s=$.el("a.change-password",{href:"#password-change",text:"change password"});t.el("span",{text:"Welcome, "+w+"! "}).append(u).appendEl("span",{text:" or "}).append(s);u.click(a);return s.facebox()}else{v=$.el("a.login",{href:"#login",text:"Log in"});r=$.el("a.register",{href:"#register",text:"Sign up"});t.el("span").append(v).appendEl("span",{text:" or "}).append(r);v.facebox();return r.facebox()}};a=function(){var r;r="/api/account/logout/";$.get(r,c);return false};l=function(u){var r,t,v,s;r=$(this).parent();v=r.data("id");s="/api/todo/delete/";t={id:v};$.post(s,t,function(w,y,x){if(w.error==null){r.remove()}return e(w)});return false};q=function(w,t){var s,v,y,x,r,u;s=$(this);u=$(this).parent().data(),y=u.id,x=u.old_label;r="/api/todo/modify/";v={id:y,label:w};$.post(r,v,function(z,B,A){if(z.error!=null){s.text(x)}else{s.parent().data("old_label",w)}return e(z)});return w};b=function(u,s){var t,r;r="/api/todo/add/";t={label:u};$.post(r,t,function(v,y,x){var w;e(v);w=s.itemtd.parent();if(v.error!=null){w.remove();return}w.data({id:v.id,old_label:u,old_priority:d});w.removeClass().addClass("todoitem");s.itemtd.editable("destroy");s.itemtd.editable(q);return s.prioritytd.editable(edit_priority,{type:"select",data:p})});return u};m=function(){var r;r="/api/todo/getlist/";return $.get(r,function(x,t,B){var y,C,s,z,D,v,A,w,u;e(x);if(x.error!=null){return}$(".additem-btn").show();s=$(".todolist").empty().append(g());w=x.items;u=[];for(v=0,A=w.length;v<A;v++){D=w[v];z=s.el("tr.todoitem");y=k(z);C=z.el("td.item",{text:D.label});z.append(i(D.priority));z.data({old_label:D.label,old_priority:D.priority,id:D.id});u.push(C.editable(q))}return u})};h=function(){var u,t,v,s,r;r=$(".todolist");v=r.el("tr.newitem");u=k(v);t=v.el("td.item");s=i().appendTo(v);t.editable(b,{onblur_cb:function(){return v.remove()},row:v,itemtd:t,prioritytd:s});t.click();return false};c=function(r,t,s){e(r);if(!(r.error!=null)){o(r.username);if(!(r.username!=null)){$(".todolist").empty();$(".additem-btn").hide()}}return $(document).trigger("close.facebox")};$(function(){f();$(".additem-btn").click(h);$(".facebox").facebox();return $(document).on("reveal.facebox",function(r){$("a.facebox").facebox();return $("form").on("submit",function(v){var s,u,t;v.preventDefault();s=$(this);t=s.attr("action");u=s.serialize();return $.post(t,u,function(w,y,x){c(w,y,x);if(s.data("refresh")===1){return m()}})})})})}).call(this);